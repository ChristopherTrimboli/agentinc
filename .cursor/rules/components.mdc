---
description: "React component patterns — Server/Client Components, styling, hooks, and UI conventions"
globs: "{app,components}/**/*.tsx"
alwaysApply: false
---

# React Component Patterns

## Server vs Client Components

Next.js 16 App Router defaults to Server Components. Only add `"use client"` when the component needs:

- React hooks (`useState`, `useEffect`, `useCallback`, etc.)
- Browser APIs (`window`, `document`, `localStorage`)
- Event handlers (`onClick`, `onChange`, etc.)
- Privy auth hooks (`useIdentityToken`, `usePrivy`)
- Third-party client libraries (PixiJS, Radix UI interactive components)

```typescript
// Server Component (default) — no directive needed
export default function AgentPage({ params }: { params: { id: string } }) {
  return <div>...</div>;
}

// Client Component — add directive at top of file
"use client";

import { useState } from "react";

export function MintWizard() {
  const [step, setStep] = useState(0);
  // ...
}
```

## Styling

### Tailwind CSS 4

- Tailwind 4 uses CSS-native configuration via `@import "tailwindcss"` in `app/globals.css` — there is no `tailwind.config.js`.
- Use Tailwind utility classes directly. Prefer composition over custom CSS.
- Use `cn()` from `@/lib/utils` to merge conditional class names (wraps `clsx` + `tailwind-merge`).

```typescript
import { cn } from "@/lib/utils";

<div className={cn(
  "rounded-lg border p-4",
  isActive && "border-[var(--coral)] bg-[var(--card-bg)]",
  className,
)} />
```

### Design System / Color Palette

The project uses a dark space-themed palette defined as CSS custom properties in `app/globals.css`:

| Token | Hex | Use |
|-------|-----|-----|
| `--white` | `#ffffff` | Text primary |
| `--black` | `#000104` | Darkest surface |
| `--abyss` | `#000028` | Background |
| `--indigo` | `#120557` | Primary/cards |
| `--coral` | `#6fec06` | Accent/CTA (green, not coral) |

Use CSS variables with Tailwind's arbitrary value syntax:

```
bg-[var(--abyss)]  text-[var(--coral)]  border-[var(--card-border)]
```

Use shadcn/ui tokens for component-level colors (`--card`, `--muted`, `--popover`, etc.).

### Fonts

- **Inter** (`--font-inter`) — body text, UI
- **Syne** (`--font-syne`) — headings, display text

Applied via `font-[family-name:var(--font-inter)]` or the `font-sans` / `font-display` utility classes if configured.

## shadcn/ui Components

- UI primitives live in `components/ui/` — generated by the shadcn CLI.
- **Do NOT manually edit** files in `components/ui/`. Use the CLI to add/update:

```bash
bunx shadcn@latest add button
bunx shadcn@latest add dialog
```

- Configuration: `components.json` (New York style, zinc base, CSS variables, Lucide icons).
- Import from `@/components/ui/button`, `@/components/ui/dialog`, etc.

## Hooks

### `useAuthFetch`

Client-side authenticated fetch. Automatically attaches the Privy identity token. Use this for ALL API calls from client components.

```typescript
import { useAuthFetch } from "@/lib/hooks/useAuthFetch";

function MyComponent() {
  const { authFetch } = useAuthFetch();

  const handleClick = async () => {
    const res = await authFetch("/api/agents", {
      method: "POST",
      body: JSON.stringify({ name: "My Agent" }),
    });
    const data = await res.json();
  };
}
```

- `authFetch` sets `Content-Type: application/json` by default.
- For file uploads (`FormData`), omit `Content-Type` — the browser sets it with the boundary.
- On 401 responses, prompt re-authentication.

### AI Chat Hook

The chat UI uses Vercel AI SDK's `useChat` hook from `@ai-sdk/react`:

```typescript
import { useChat } from "@ai-sdk/react";

const { messages, input, handleInputChange, handleSubmit, isLoading } = useChat({
  api: "/api/chat",
  body: { agentId, model, enabledSkills, enabledToolGroups },
  headers: { "privy-id-token": identityToken },
});
```

## Toast Notifications

Use Sonner for toast notifications:

```typescript
import { toast } from "sonner";

toast.success("Agent created successfully");
toast.error("Failed to mint agent");
```

## Component Organization

- **Shared components** → `components/` (reusable across pages)
- **Page-specific components** → `app/components/` (used by one feature area)
- **UI primitives** → `components/ui/` (shadcn, do not edit)
- Co-locate component-specific types in the same file unless shared.

## Common Patterns

### Loading States

```typescript
{isLoading ? (
  <div className="animate-pulse h-8 bg-[var(--surface-light)] rounded" />
) : (
  <ActualContent />
)}
```

### Error Boundaries

Wrap complex client components in error boundaries. Use Next.js `error.tsx` files for route-level errors.

### Image Handling

Use `next/image` for optimized images. Remote images must be allowlisted in `next.config.ts`:

```typescript
import Image from "next/image";

<Image
  src={agent.imageUrl}
  alt={agent.name}
  width={200}
  height={200}
  className="rounded-full"
/>
```

Allowed remote hostname: `k66h8in2vmxpcqdj.public.blob.vercel-storage.com` (Vercel Blob).
